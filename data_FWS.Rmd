---
title: "ACCS-UAA Water Temp Data Import"
output:
  html_document: 
    df_print: paged
    fig_width: 10
    fig_height: 6
    fig_caption: yes
    code_folding: hide
    toc: true
    toc_depth: 4
    toc_float:
      collapsed: false
      smooth_scroll: false
editor_options: 
  chunk_output_type: inline
---

Document last updated `r Sys.time()` by Benjamin Meyer (benjamin.meyer.ak@gmail.com)

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

# clear environment
rm(list=ls())

# load packages
library(tidyverse)
library(lubridate)
library(readr)
library(readxl)
library(hms)
library(plotly)
```

Read in data from FWS folder -- work in progress here
```{r}
# FWS data is structured such that individual sites are separated by tabs, with one tab for metadata

# working to replicate example in "data_Deshka_Temperature>Model.Rmd", seems most similar to read-in process needed here.

# 11/9/20 not yet successful; plan to talk with Becky before continuing

fws_folder <- "data/FWS"

files <- list.files(path = paste(fws_folder, sep = ""), pattern = ".xlsx", full.names = TRUE)

files <- files[!files %in% (grep("availability", files, value = TRUE))]


# function from other of Becky's examples
combine_sheets_with_site_ID <- function(excel_file_path) {
  sheets <- excel_sheets(excel_file_path)
  sheets <- sheets[!grepl("metadata", sheets)] # filtering to remove the metadata sheet
  all_dat <- tibble()
  for(i in sheets){
    dat <- read_excel(excel_file_path, sheet = i) %>% 
      mutate(SiteID = i)
    all_dat <- bind_rows(all_dat, dat)
  }
  return(all_dat)
}


temp <- files %>% 
  map_df(function(x) combine_sheets_with_site_ID(x)) 




# this suggested code produces repetitive error, 'Expecting numeric in C21845 / R21845C3: got '---'
path <- "data/FWS/Togiak_Oct2020_Part2.xlsx"
z <- path %>% 
  excel_sheets() %>% 
  set_names() %>% 
  map(read_excel, path = path)


# note: some files have a "location description" column and others do not


```

Example for one workbook -- I would just deal with each separately and combine at the end.

```{r}
#becky's togiak 1 dataset
togiak1 <- "S:/Stream Temperature Data/USFWS Perdue - complete 2020/Togiak_Oct2020_Part1.xlsx"

sheets <- excel_sheets(togiak1)
sheets <- sheets[!grepl("metadata", sheets)] # filtering to remove the metadata sheet
tog1_dat <- tibble()
for(i in sheets){
  dat <- read_excel(togiak1, sheet = i, skip = 1, col_types = c("date", "date", "text"), 
                    col_names = c("date", "time", "temp")) %>%
    mutate(SiteID = i)
  tog1_dat <- bind_rows(tog1_dat, dat)
}


```

This read in fine for me. I had to change the temp field to text because there are strange entries. From here, try to deal with date/time formatting and temperature data so all correct classes. 

```{r}
summary(tog1_dat)

tog1_dat

tog1_dat %>% 
  mutate(sampleDate = as.Date(date, format ), # make edits here to pull off time
         sampleTime = as.hms ()) # makes edits here to pull off date

tog1_dat %>% 
  filter() #get rid of missing temp data "---" others?




```

