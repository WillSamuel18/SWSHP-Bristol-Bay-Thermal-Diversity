---
title: "ACCS-UAA Water Temp Data Import"
output:
  html_document: 
    df_print: paged
    fig_width: 10
    fig_height: 6
    fig_caption: yes
    code_folding: hide
    toc: true
    toc_depth: 4
    toc_float:
      collapsed: false
      smooth_scroll: false
editor_options: 
  chunk_output_type: inline
---

Document last updated `r Sys.time()` by Benjamin Meyer (benjamin.meyer.ak@gmail.com)

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

# clear environment
rm(list=ls())

# load packages
library(tidyverse)
library(lubridate)
library(readr)
library(readxl)
library(hms)
library(plotly)
```


<br>

### Data Import

Read in Excel files, one at a time.  Note: data is structured such that individual sites are separated by tabs, with one tab for metadata.

Read in "Togiak_Oct2020_Part1.xlsx"
```{r}
#becky's togiak 1 dataset
#togiak1 <- "S:/Stream Temperature Data/USFWS Perdue - complete 2020/Togiak_Oct2020_Part1.xlsx"

# ben's togiak1 dataset path
togiak1 <- "data/FWS/Togiak_Oct2020_Part1.xlsx"

sheets <- excel_sheets(togiak1)
sheets <- sheets[!grepl("metadata", sheets)] # filtering to remove the metadata sheet
tog1_dat <- tibble()
for(i in sheets){
  dat <- read_excel(togiak1, sheet = i, skip = 1, col_types = c("date", "date", "text"), 
                    col_names = c("date", "time", "temp")) %>%
    mutate(SiteID = i)
  tog1_dat <- bind_rows(tog1_dat, dat)
}

```

<br>

Read in "Togiak_Oct2020_Part2.xlsx"
```{r}
# ben's togiak2 dataset path
togiak2 <- "data/FWS/Togiak_Oct2020_Part2.xlsx"

sheets <- excel_sheets(togiak2)
sheets <- sheets[!grepl("metadata", sheets)] # filtering to remove the metadata sheet
tog2_dat <- tibble()
for(i in sheets){
  dat <- read_excel(togiak2, 
                    sheet = i, 
                    skip = 1, 
                    col_types = c("date", "date", "text"), 
                    col_names = c("date", "time", "temp")) %>%
    mutate(SiteID = i)
  tog2_dat <- bind_rows(tog2_dat, dat)
}

```

<br>

Read in Egegik data, "WRB_Oct2020.xlsx"
```{r}
# ben's egegik dataset path
egegik <- "data/FWS/WRB_Oct2020.xlsx"

sheets <- excel_sheets(egegik)
sheets <- sheets[!grepl("metadata", sheets)] # filtering to remove the metadata sheet
egegik_dat <- tibble()
for(i in sheets){
  dat <- read_excel(egegik, 
                    sheet = i, 
                    skip = 1, 
                    col_types = c("date", "date", "text"), 
                    col_names = c("date", "time", "temp")) %>%
    mutate(SiteID = i)
  egegik_dat <- bind_rows(egegik_dat, dat)
}

```

<br>

Combine the three data sources and format as specified in Project_notes.Rmd
```{r}
fws.data <- bind_rows(tog1_dat,tog2_dat,egegik_dat) %>%
  rename(Temperature = temp,
         sampleTime = time,
         sampleDate = date) %>%
  transform(Temperature = as.numeric(Temperature),
            sampleDate = as.Date(sampleDate),
            sampleTime = hms::as.hms(sampleTime)) %>%
  filter(!is.na(Temperature))

```

<br>

Read in metadata and use to assign AKOATS_IDs
```{r}
# togiak1
togiak1_metadata <- read_excel("data/FWS/Togiak_Oct2020_Part1.xlsx", sheet = "AKOATS_metadata")

#togiak2
togiak2_metadata <- read_excel("data/FWS/Togiak_Oct2020_Part2.xlsx", sheet = "AKOATS_metadata")

#egegik
egegik_metadata <- read_excel("data/FWS/WRB_Oct2020.xlsx", sheet = "AKOATS_metadata")

# combine metadata sheets
fws.metadata <- bind_rows(togiak1_metadata,togiak2_metadata,egegik_metadata) %>%
  select(AKOATS_ID,SiteID,Waterbody_name)

# 
fws.data <- left_join(fws.data,fws.metadata,by = "SiteID") %>%
  distinct()

# remove extraneous objects
rm(togiak1_metadata,togiak2_metadata,egegik_metadata,egegik_dat,tog1_dat,tog2_dat,dat)

```


Plot


Assign useData column





This read in fine for me. I had to change the temp field to text because there are strange entries. From here, try to deal with date/time formatting and temperature data so all correct classes. 

```{r}
summary(tog1_dat)

tog1_dat

tog1_dat %>% 
  mutate(sampleDate = as.Date(date, format ), # make edits here to pull off time
         sampleTime = as.hms ()) # makes edits here to pull off date

tog1_dat %>% 
  filter() #get rid of missing temp data "---" others?




```

