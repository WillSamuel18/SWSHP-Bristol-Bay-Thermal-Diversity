---
knit: (function(input_file, encoding) {
  out_dir <- 'docs';
  rmarkdown::render(input_file,
 encoding=encoding,
 output_file=file.path(dirname(input_file), out_dir, 'index.html'))})
title: "Bristol Bay Temperature Data Summary"
output:
  html_document: 
    df_print: paged
    fig_width: 10
    fig_height: 6
    fig_caption: yes
    code_folding: hide
    toc: true
    toc_depth: 4
    toc_float:
      collapsed: false
      smooth_scroll: false
editor_options: 
  chunk_output_type: inline
---

Document created by Benjamin Meyer (benjamin.meyer.ak@gmail.com) and last updated `r Sys.time()` by Rebecca Shaftel (rsshaftel@alaska.edu). 

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

# clear environment
rm(list=ls())

# load packages
library(tidyverse)
library(lubridate)
library(readr)
library(readxl)
library(hms)
library(plotly)
library(DT)
library(leaflet)


```

stopping notes - need to go through nps data. also wrb could have data for egegik, maybe others in knb download. meg just provided post 2017 data for them. maybe focus on nps data for streams and beaches first, then do lake arrays later. 


# Cook Inletkeeper

```{r}
cik.data <- read_rds("output/cik_data.rds")

cik.data %>% 
  filter(SiteID == "Lost Dog Creek")

cik.data %>%
  group_by(SiteID, sampleDate) %>% 
  summarize(meanT = mean(Temperature)) %>%
  complete(SiteID, sampleDate = seq.Date(min(sampleDate), max(sampleDate), by = "day")) %>% 
  ggplot(aes(x = sampleDate, y = meanT)) +
  geom_line() +
  facet_wrap(~ SiteID, scales = "free_x") +
  ggtitle("Original Logger Data by Site and Year")

cik.data %>%
  group_by(SiteID, sampleDate) %>% 
  summarize(meanT = mean(Temperature)) %>%
  complete(SiteID, sampleDate = seq.Date(min(sampleDate), max(sampleDate), by = "day")) %>% 
  ggplot(aes(x = sampleDate, y = meanT, color = SiteID)) +
  geom_line() +
  # facet_wrap(~ SiteID, scales = "free_x") +
  ggtitle("Original Logger Data by Site and Year")

```



# Map of sites and years of data

This leaflet map shows the location of all of the sites that we have data for. Selecting each marker will show the data provider, the site name, the start year, the end year, and the number of years of data. Currently, only streams and rivers sites have been included.

```{r uw}
uw.md <- read_rds("output/uw_metadata.rds")
uw.sum <- read_rds("output/uw_data_summ.rds")
uw.dat <- left_join(uw.md, uw.sum)

```

```{r accs}
accs.md <- read_rds("output/accs_metadata.rds")
accs.sum <- read_rds("output/accs_data_summ.rds")
accs.dat <- left_join(accs.md, accs.sum)

```

```{r cik}
cik.md <- read_rds("output/cik_metadata.rds")
cik.sum <- read_rds("output/cik_data_summ.rds")
cik.dat <- left_join(cik.md, cik.sum)

cik.dat
```

```{r fws}
fws.md <- read_rds("output/fws_metadata.rds")
fws.sum <- read_rds("output/fws_data_summ.rds")
fws.dat <- left_join(fws.md, fws.sum)

fws.dat

```



```{r combine}
all.dat <- bind_rows(uw.dat, accs.dat, cik.dat, fws.dat)
```


```{r leaflet map}

# create map
leaflet() %>%
  addTiles() %>%  # Add default OpenStreetMap map tiles
  #fitBounds(-150, 60.04,-149.0, 60.02) %>%
  #setView(-150.210169, 60.487694, zoom = 8) %>%
  addMarkers(lng = all.dat$Longitude, lat = all.dat$Latitude,
             popup = paste("SiteID = ", all.dat$SiteID, "<br>",
                           "Data Source = ", all.dat$SourceName, "<br>",
                           "Start Year = ", all.dat$startYear, "<br>",
                           "End Year = ", all.dat$endYear, "<br>",
                           "Total Years of Data = ", all.dat$totYears, "<br>"))

```



